---
apiVersion: mongodb.com/v1
kind: MongoDBOpsManager
metadata:
  name: ops-manager
  namespace: mongodb
spec:
  # the number of Ops Manager instances to run. Set to value bigger
  # than 1 to get high availability and upgrades without downtime
  replicas: 1
  statefulSet:
    spec:
      template:
        spec:
          containers:
            - name: mongodb-ops-manager
              resources:
                limits:                  
                  memory: 7G
                  cpu: 2
                requests:                  
                  memory: 7G
                  cpu: 2

  # the version of Ops Manager distro to use
  version: 8.0.0

  # optional. Specify the custom cluster domain of the Kubernetes cluster if it's different from the default one ('cluster.local').
  # This affects the urls generated by the Operator.
  # This field is also used for Application Database url
  # clusterDomain: mycompany.net

  # the name of the secret containing admin user credentials.
  # Either remove the secret or change the password using Ops Manager UI after the Ops Manager
  # resource is created!
  adminCredentials: ops-manager-admin-secret

  # optional. The Ops Manager configuration. All the values must be of type string
  configuration:
    mms.fromEmailAddr: "admin@example.com"

  # the application database backing Ops Manager. Replica Set is the only supported type
  # Application database has the SCRAM-SHA authentication mode always enabled
  applicationDatabase:
    members: 3
    version:  8.0.0-ubi8
    # optional. Allows to pass custom MongoDB process configuration
    additionalMongodConfig:
      operationProfiling:
        mode: slowOp
  backup:
    enabled: true
    members: 1
    s3Stores:
      - name: s3Store1
        # the name of the secret which contains aws credentials
        s3SecretRef:
          name: my-aws-creds
        s3BucketEndpoint: s3.us-west-2.amazonaws.com
        s3BucketName: mcourcy-ops-manager-snapshot-store
        pathStyleAccessEnabled: true
    s3OpLogStores:
      - name: s3OpLogStore1
        # the name of the secret which contains aws credentials
        s3SecretRef:
          name: my-aws-creds
        s3BucketEndpoint: s3.us-west-2.amazonaws.com
        s3BucketName: mcourcy-ops-manager-oplog-store
        pathStyleAccessEnabled: true
    #statefulSet:
    #  spec:
    #    template:
    #      spec:
    #        containers:
    #          - name: mongodb-backup-daemon
    #            resources:
    #              requests:
    #                cpu: '1'
    #                memory: 5G